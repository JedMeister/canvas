cat >>/etc/apache2/sites-available/canvas.conf<<EOF
Listen 3000
<VirtualHost *:3000>
  ServerName localhost
  ServerAlias localhost 

  SSLEngine on
  SSLCertificateKeyFile /etc/ssl/private/cert.key
  SSLCertificateFile /etc/ssl/private/cert.pem
  PassengerAppRoot /var/www/canvas-rce-api
  PassengerAppType node
  PassengerStartupFile app.js
</VirtualHost>
EOF

git clone --depth=1 https://github.com/instructure/canvas-rce-api.git /var/www/canvas-rce-api

cd /var/www/canvas-rce-api

npm i --production
cp .env.example .env


sed -i "s|^PORT=.*|PORT=3000|" .env
sed -i "s|NODE_ENV=.*|NODE_ENV=production|" .env

a2ensite canvas-rce-api
